/*
 * VirtualProductSelectionPanel.java
 *
 * Created on Вторник, 2008, Юни 17, 21:53
 */

package com.cosmos.acacia.crm.gui.assembling;

import com.cosmos.acacia.crm.bl.assembling.AssemblingRemote;
import com.cosmos.acacia.crm.data.SimpleProduct;
import com.cosmos.acacia.crm.data.assembling.AssemblingSchema;
import com.cosmos.acacia.crm.data.assembling.AssemblingSchemaItemValue;
import com.cosmos.acacia.crm.data.assembling.RealProduct;
import com.cosmos.acacia.crm.data.assembling.VirtualProduct;
import com.cosmos.acacia.crm.gui.ProductsListPanel;
import com.cosmos.acacia.gui.AcaciaPanel;
import com.cosmos.swingb.DialogResponse;
import javax.ejb.EJB;
import org.jdesktop.application.Action;

/**
 *
 * @author  Miro
 */
public class VirtualProductSelectionPanel
    extends AcaciaPanel
{
    @EJB
    private static AssemblingRemote formSession;

    /** Creates new form VirtualProductSelectionPanel */
    public VirtualProductSelectionPanel(AssemblingSchemaItemValue itemValue)
    {
        super(itemValue);
        if(getParentDataObjectId() == null)
            throw new IllegalArgumentException("The ItemValue MUST be initialized with persisted AssemblingSchemaItem object as parent.");
        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        messageLabel = new com.cosmos.swingb.JBLabel();
        cancelButton = new com.cosmos.swingb.JBButton();
        productButton = new com.cosmos.swingb.JBButton();
        schemaButton = new com.cosmos.swingb.JBButton();

        setName("Form"); // NOI18N

        messageLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(com.cosmos.acacia.crm.gui.AcaciaApplication.class).getContext().getResourceMap(VirtualProductSelectionPanel.class);
        messageLabel.setText(resourceMap.getString("messageLabel.text")); // NOI18N
        messageLabel.setName("messageLabel"); // NOI18N

        javax.swing.ActionMap actionMap = org.jdesktop.application.Application.getInstance(com.cosmos.acacia.crm.gui.AcaciaApplication.class).getContext().getActionMap(VirtualProductSelectionPanel.class, this);
        cancelButton.setAction(actionMap.get("cancelAction")); // NOI18N
        cancelButton.setText(resourceMap.getString("cancelButton.text")); // NOI18N
        cancelButton.setName("cancelButton"); // NOI18N

        productButton.setAction(actionMap.get("productSelectionAction")); // NOI18N
        productButton.setName("productButton"); // NOI18N

        schemaButton.setAction(actionMap.get("schemaSelectionAction")); // NOI18N
        schemaButton.setText(resourceMap.getString("schemaButton.text")); // NOI18N
        schemaButton.setName("schemaButton"); // NOI18N

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(messageLabel, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 379, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(productButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(schemaButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 100, Short.MAX_VALUE)
                        .addComponent(cancelButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );

        layout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {cancelButton, productButton, schemaButton});

        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(messageLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 66, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cancelButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(productButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(schemaButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        layout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {cancelButton, productButton, schemaButton});

    }// </editor-fold>//GEN-END:initComponents


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private com.cosmos.swingb.JBButton cancelButton;
    private com.cosmos.swingb.JBLabel messageLabel;
    private com.cosmos.swingb.JBButton productButton;
    private com.cosmos.swingb.JBButton schemaButton;
    // End of variables declaration//GEN-END:variables


    @Override
    protected void initData()
    {
    }

    @Action
    public void productSelectionAction()
    {
        ProductsListPanel productsPanel = new ProductsListPanel(null);
        DialogResponse response = productsPanel.showDialog(this);
        setDialogResponse(response);
        if(DialogResponse.SELECT.equals(response))
        {
            SimpleProduct simpleProduct = (SimpleProduct)productsPanel.getSelectedRowObject();
            RealProduct realProduct = getFormSession().getRealProduct(simpleProduct);
            setSelectedValue(realProduct);
        }

        close();
    }

    @Action
    public void schemaSelectionAction()
    {
        AssemblingSchemasListPanel asListPanel = new AssemblingSchemasListPanel(null);
        asListPanel.setVisibleSelectButtons(true);
        DialogResponse response = asListPanel.showDialog(this);
        setDialogResponse(response);
        if(DialogResponse.SELECT.equals(response))
        {
            AssemblingSchema assemblingSchema = (AssemblingSchema)asListPanel.getSelectedRowObject();
            setSelectedValue(assemblingSchema);
        }

        close();
    }

    @Action
    public void cancelAction()
    {
        close();
    }

    protected AssemblingRemote getFormSession()
    {
        if(formSession == null)
        {
            formSession = getRemoteBean(this, AssemblingRemote.class);
        }

        return formSession;
    }
}
